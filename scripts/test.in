#! /usr/bin/env sh

set -e
set -C
set -u

SRCDIR="@srcdir@"
ROOT="$(cd "$(dirname "$0")" && pwd)"
if test "x${XDG_RUNTIME_DIR}" = "x"
then
    # TODO: Find a fallback
    echo "Don't have a runtime directory" >2
    exit 1
fi

mkdir -p "${XDG_RUNTIME_DIR}/linted/chroot"

export LINTED_UNIT_PATH="\
${SRCDIR}/src/controller/units\
:${SRCDIR}/src/gui/units\
:${SRCDIR}/src/logger/units\
:${SRCDIR}/src/log/units\
:${SRCDIR}/src/simulator/units\
:${SRCDIR}/src/updater/units"

export LINTED_CHROOT="${XDG_RUNTIME_DIR}/linted/chroot"

export LINTED_INIT="${ROOT}/../src/init/init"

export LINTED_LOGGER_FSTAB="${SRCDIR}/src/logger/logger-fstab"
export LINTED_LOGGER="${ROOT}/../src/logger/logger"

export LINTED_SIMULATOR_FSTAB="${SRCDIR}/src/simulator/simulator-fstab"
export LINTED_SIMULATOR="${ROOT}/../src/simulator/simulator"

export LINTED_GUI_FSTAB="${SRCDIR}/src/gui/gui-fstab"
export LINTED_GUI="${ROOT}/../src/gui/gui"

exec "${ROOT}/../src/linted/linted" "$@"
