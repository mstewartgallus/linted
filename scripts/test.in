#! /usr/bin/env sh

set -e
set -C
set -u

SRCDIR="@srcdir@"
ROOT="$(cd "$(dirname "$0")" && pwd)"
if test "x${XDG_RUNTIME_DIR:+x}" = "x"
then
    # TODO: Find a fallback
    echo "XDG_RUNTIME_DIR is a required environment variable" >&2
    exit 1
fi

mkdir -p "${XDG_RUNTIME_DIR}/linted/chroot"

: ${LINTED_UNIT_PATH:="\
${SRCDIR}/src/controller/units\
:${SRCDIR}/src/drawer/units\
:${SRCDIR}/src/gui/units\
:${SRCDIR}/src/logger/units\
:${SRCDIR}/src/log/units\
:${SRCDIR}/src/simulator/units\
:${SRCDIR}/src/updater/units\
:${SRCDIR}/src/window-notifier/units"}

: ${LINTED_CHROOT:="${XDG_RUNTIME_DIR}/linted/chroot"}

: ${LINTED_INIT:="${ROOT}/../src/init/init"}

: ${LINTED_LOGGER_FSTAB:="${SRCDIR}/src/logger/logger-fstab"}
: ${LINTED_LOGGER:="${ROOT}/../src/logger/logger"}

: ${LINTED_SIMULATOR_FSTAB:="${SRCDIR}/src/simulator/simulator-fstab"}
: ${LINTED_SIMULATOR:="${ROOT}/../src/simulator/simulator"}

: ${LINTED_GUI_FSTAB:="${SRCDIR}/src/gui/gui-fstab"}
: ${LINTED_GUI:="${ROOT}/../src/gui/gui"}

: ${LINTED_DRAWER_FSTAB:="${SRCDIR}/src/drawer/drawer-fstab"}
: ${LINTED_DRAWER:="${ROOT}/../src/drawer/drawer"}

export LINTED_UNIT_PATH
export LINTED_CHROOT
export LINTED_INIT
export LINTED_LOGGER_FSTAB
export LINTED_LOGGER
export LINTED_SIMULATOR_FSTAB
export LINTED_SIMULATOR
export LINTED_GUI_FSTAB
export LINTED_GUI
export LINTED_DRAWER_FSTAB
export LINTED_DRAWER

exec "${ROOT}/../src/linted/linted" "$@"
