#! /usr/bin/env sh

set -e
set -C
set -u

SCRIPTS="@srcdir@"
BINARY="$1"

: ${LINTED_CPPCHECK:=cppcheck}

source_cflags() {
    "${SCRIPTS}/json-cc-flags.py" "${BINARY}"
}

source_files() {
    "${SCRIPTS}/json-cc-files.py" "${BINARY}"
}

"${LINTED_CPPCHECK}"\
    --quiet\
    --enable=all\
    --suppress=resourceLeak\
    --suppress=variableScope\
    --suppress=sizeofwithsilentarraypointer\
    --suppress=uninitvar\
    --template='{file}:{line}: ({id}) {message}'\
    $(source_cflags)\
    $(source_files)
